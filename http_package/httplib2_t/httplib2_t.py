# Copyright (c) 2018 Ainnovation.
# All rights reserved.
#
# Author: liuqw <liuqingwei@ainnovation.com>
# Date:   2020/6/19
"""循环获得 Phoenix Serving 的预测结果，同时测试 httplib2 库的使用。
"""
import json
import uuid
from random import randint
from time import sleep

import httplib2

# global vars
ip = 'ubuntu.me.lan'
port = '7795'
path = '/v1/phoenix'

http_client = httplib2.HTTPConnectionWithTimeout(ip, port, timeout=10)
body = {"request_id": "test_id", "serving_id":"serving-sv-credit-card-hhswqsj3jtiw82wbk3eas6", "args": {"features": [["20000", "2", "2", "1", "24", "2", "2", "-1", "-1", "-2", "-2", "3913", "3102", "689", "0", "0", "0", "0", "689", "0", "0", "0", "0"], ["120000", "2", "2", "2", "26", "-1", "2", "0", "0", "0", "2", "2682", "1725", "2682", "3272", "3455", "3261", "0", "1000", "1000", "1000", "0", "2000"], ["90000", "2", "2", "2", "34", "0", "0", "0", "0", "0", "0", "29239", "14027", "13559", "14331", "14948", "15549", "1518", "1500", "1000", "1000", "1000", "5000"], ["50000", "2", "2", "1", "37", "0", "0", "0", "0", "0", "0", "46990", "48233", "49291", "28314", "28959", "29547", "2000", "2019", "1200", "1100", "1069", "1000"], ["50000", "1", "2", "1", "57", "-1", "0", "-1", "0", "0", "0", "8617", "5670", "35835", "20940", "19146", "19131", "2000", "36681", "10000", "9000", "689", "679"], ["50000", "1", "1", "2", "37", "0", "0", "0", "0", "0", "0", "64400", "57069", "57608", "19394", "19619", "20024", "2500", "1815", "657", "1000", "1000", "800"], ["500000", "1", "1", "2", "29", "0", "0", "0", "0", "0", "0", "367965", "412023", "445007", "542653", "483003", "473944", "55000", "40000", "38000", "20239", "13750", "13770"], ["100000", "2", "2", "2", "23", "0", "-1", "-1", "0", "0", "-1", "11876", "380", "601", "221", "-159", "567", "380", "601", "0", "581", "1687", "1542"], ["140000", "2", "3", "1", "28", "0", "0", "2", "0", "0", "0", "11285", "14096", "12108", "12211", "11793", "3719", "3329", "0", "432", "1000", "1000", "1000"], ["20000", "1", "3", "2", "35", "-2", "-2", "-2", "-2", "-1", "-1", "0", "0", "0", "0", "13007", "13912", "0", "0", "0", "13007", "1122", "0"], ["200000", "2", "3", "2", "34", "0", "0", "2", "0", "0", "-1", "11073", "9787", "5535", "2513", "1828", "3731", "2306", "12", "50", "300", "3738", "66"], ["260000", "2", "1", "2", "51", "-1", "-1", "-1", "-1", "-1", "2", "12261", "21670", "9966", "8517", "22287", "13668", "21818", "9966", "8583", "22301", "0", "3640"], ["630000", "2", "2", "2", "41", "-1", "0", "-1", "-1", "-1", "-1", "12137", "6500", "6500", "6500", "6500", "2870", "1000", "6500", "6500", "6500", "2870", "0"], ["70000", "1", "2", "2", "30", "1", "2", "2", "0", "0", "2", "65802", "67369", "65701", "66782", "36137", "36894", "3200", "0", "3000", "3000", "1500", "0"], ["250000", "1", "1", "2", "29", "0", "0", "0", "0", "0", "0", "70887", "67060", "63561", "59696", "56875", "55512", "3000", "3000", "3000", "3000", "3000", "3000"], ["50000", "2", "3", "3", "23", "1", "2", "0", "0", "0", "0", "50614", "29173", "28116", "28771", "29531", "30211", "0", "1500", "1100", "1200", "1300", "1100"], ["20000", "1", "1", "2", "24", "0", "0", "2", "2", "2", "2", "15376", "18010", "17428", "18338", "17905", "19104", "3200", "0", "1500", "0", "1650", "0"], ["320000", "1", "1", "1", "49", "0", "0", "0", "-1", "-1", "-1", "253286", "246536", "194663", "70074", "5856", "195599", "10358", "10000", "75940", "20000", "195599", "50000"], ["360000", "2", "1", "1", "49", "1", "-2", "-2", "-2", "-2", "-2", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], ["180000", "2", "1", "2", "29", "1", "-2", "-2", "-2", "-2", "-2", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"], ["130000", "2", "3", "2", "39", "0", "0", "0", "0", "0", "-1", "38358", "27688", "24489", "20616", "11802", "930", "3000", "1537", "1000", "2000", "930", "33764"], ["120000", "2", "2", "1", "39", "-1", "-1", "-1", "-1", "-1", "-1", "316", "316", "316", "0", "632", "316", "316", "316", "0", "632", "316", "0"], ["70000", "2", "2", "2", "26", "2", "0", "0", "2", "2", "2", "41087", "42445", "45020", "44006", "46905", "46012", "2007", "3582", "0", "3601", "0", "1820"], ["450000", "2", "1", "1", "40", "-2", "-2", "-2", "-2", "-2", "-2", "5512", "19420", "1473", "560", "0", "0", "19428", "1473", "560", "0", "0", "1128"], ["90000", "1", "1", "2", "23", "0", "0", "0", "-1", "0", "0", "4744", "7070", "0", "5398", "6360", "8292", "5757", "0", "5398", "1200", "2045", "2000"], ["50000", "1", "3", "2", "23", "0", "0", "0", "0", "0", "0", "47620", "41810", "36023", "28967", "29829", "30046", "1973", "1426", "1001", "1432", "1062", "997"], ["60000", "1", "1", "2", "27", "1", "-2", "-1", "-1", "-1", "-1", "-109", "-425", "259", "-57", "127", "-189", "0", "1000", "0", "500", "0", "1000"], ["50000", "2", "3", "2", "30", "0", "0", "0", "0", "0", "0", "22541", "16138", "17163", "17878", "18931", "19617", "1300", "1300", "1000", "1500", "1000", "1012"], ["50000", "2", "3", "1", "47", "-1", "-1", "-1", "-1", "-1", "-1", "650", "3415", "3416", "2040", "30430", "257", "3415", "3421", "2044", "30430", "257", "0"], ["50000", "1", "1", "2", "26", "0", "0", "0", "0", "0", "0", "15329", "16575", "17496", "17907", "18375", "11400", "1500", "1500", "1000", "1000", "1600", "0"], ["230000", "2", "1", "2", "27", "-1", "-1", "-1", "-1", "-1", "-1", "16646", "17265", "13266", "15339", "14307", "36923", "17270", "13281", "15339", "14307", "37292", "0"], ["50000", "1", "2", "2", "33", "2", "0", "0", "0", "0", "0", "30518", "29618", "22102", "22734", "23217", "23680", "1718", "1500", "1000", "1000", "1000", "716"], ["100000", "1", "1", "2", "32", "0", "0", "0", "0", "0", "0", "93036", "84071", "82880", "80958", "78703", "75589", "3023", "3511", "3302", "3204", "3200", "2504"], ["500000", "2", "2", "1", "54", "-2", "-2", "-2", "-2", "-2", "-2", "10929", "4152", "22722", "7521", "71439", "8981", "4152", "22827", "7521", "71439", "981", "51582"], ["500000", "1", "1", "1", "58", "-2", "-2", "-2", "-2", "-2", "-2", "13709", "5006", "31130", "3180", "0", "5293", "5006", "31178", "3180", "0", "5293", "768"], ["160000", "1", "1", "2", "30", "-1", "-1", "-2", "-2", "-2", "-1", "30265", "-131", "-527", "-923", "-1488", "-1884", "131", "396", "396", "565", "792", "0"], ["280000", "1", "2", "1", "40", "0", "0", "0", "0", "0", "0", "186503", "181328", "180422", "170410", "173901", "177413", "8026", "8060", "6300", "6400", "6400", "6737"], ["60000", "2", "2", "2", "22", "0", "0", "0", "0", "0", "-1", "15054", "9806", "11068", "6026", "-28335", "18660", "1500", "1518", "2043", "0", "47671", "617"], ["50000", "1", "1", "2", "25", "1", "-1", "-1", "-2", "-2", "-2", "0", "780", "0", "0", "0", "0", "780", "0", "0", "0", "0", "0"], ["280000", "1", "1", "2", "31", "-1", "-1", "2", "-1", "0", "-1", "498", "9075", "4641", "9976", "17976", "9477", "9075", "0", "9976", "8000", "9525", "781"], ["360000", "1", "1", "2", "33", "0", "0", "0", "0", "0", "0", "218668", "221296", "206895", "628699", "195969", "179224", "10000", "7000", "6000", "188840", "28000", "4000"], ["70000", "2", "1", "2", "25", "0", "0", "0", "0", "0", "0", "67521", "66999", "63949", "63699", "64718", "65970", "3000", "4500", "4042", "2500", "2800", "2500"], ["10000", "1", "2", "2", "22", "0", "0", "0", "0", "0", "0", "1877", "3184", "6003", "3576", "3670", "4451", "1500", "2927", "1000", "300", "1000", "500"], ["140000", "2", "2", "1", "37", "0", "0", "0", "0", "0", "0", "59504", "61544", "62925", "64280", "67079", "69802", "3000", "3000", "3000", "4000", "4000", "3000"], ["40000", "2", "1", "2", "30", "0", "0", "0", "2", "0", "0", "18927", "21295", "25921", "25209", "26636", "29197", "3000", "5000", "0", "2000", "3000", "0"], ["210000", "1", "1", "2", "29", "-2", "-2", "-2", "-2", "-2", "-2", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0"]]}}


def request_id(prefix="ID"):
    return "##".join([prefix, str(uuid.uuid1())])


# send request in a cycle
cnt = 0
while True:
    sleep(randint(0, 30))
    cnt += 1
    print("第%s次请求：" % cnt)
    serving_id = request_id("request")
    body['request_id'] = serving_id
    params = json.dumps(body)
    print("params", params)
    http_client.request("POST", path, params)
    response_json = http_client.getresponse().read().decode()
    print(response_json)
